<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <link rel="stylesheet" href="index.css" />
    <title>Feathers</title>
  </head>

  <body class="bg-gray-700">
    <table class="text-md table-fixed w-screen h-screen text-center">
      <tr class="border-b-5">
        <th class="bg-slate-500 h-12 w-12">
          <button
            class="bg-slate-500 hover:cursor-pointer focus:bg-slate-700 transition-all hover:bg-slate-700 active:bg-slate-700 text-white font-bold py-4 px-4"
            onclick="reset()"
          >
            <img src="src/reset.svg" class="w-5" />
          </button>
        </th>
        <th class="bg-slate-500 w-27">MultiPlayer</th>
        <th class="bg-red-500 text-2xl" contenteditable="true" player="1">
          P1
        </th>
        <th class="bg-amber-400 text-2xl" contenteditable="true" player="2">
          P2
        </th>
        <th class="bg-green-400 text-2xl" contenteditable="true" player="3">
          P3
        </th>
        <th class="bg-sky-500 text-2xl" contenteditable="true" player="4">
          P4
        </th>
        <th class="bg-violet-500 text-2xl" contenteditable="true" player="5">
          P5
        </th>
      </tr>
      <tr>
        <th class="bg-slate-400" rowspan="3">
          <div
            class="bg-slate-400 [writing-mode:sideways-lr] h-[100%] w-[100%] flex justify-center items-center"
          >
            <p>Points on Cards</p>
          </div>
        </th>
        <th class="bg-slate-200">Birds</th>
        <td class="bg-red-200 text-3xl" player="1" contenteditable="true">0</td>
        <td class="bg-amber-200 text-3xl" player="2" contenteditable="true">
          0
        </td>
        <td class="bg-green-200 text-3xl" player="3" contenteditable="true">
          0
        </td>
        <td class="bg-sky-200 text-3xl" player="4" contenteditable="true">
          0
        </td>
        <td class="bg-violet-200 text-3xl" player="5" contenteditable="true">
          0
        </td>
      </tr>
      <tr>
        <th class="bg-slate-200">Bonus Cards</th>
        <td class="bg-red-200 text-3xl" player="1" contenteditable="true">0</td>
        <td class="bg-amber-200 text-3xl" player="2" contenteditable="true">
          0
        </td>
        <td class="bg-green-200 text-3xl" player="3" contenteditable="true">
          0
        </td>
        <td class="bg-sky-200 text-3xl" player="4" contenteditable="true">
          0
        </td>
        <td class="bg-violet-200 text-3xl" player="5" contenteditable="true">
          0
        </td>
      </tr>
      <tr>
        <th class="bg-slate-200">End-of-Round Goals</th>
        <td class="bg-red-200 text-3xl" player="1" contenteditable="true">0</td>
        <td class="bg-amber-200 text-3xl" player="2" contenteditable="true">
          0
        </td>
        <td class="bg-green-200 text-3xl" player="3" contenteditable="true">
          0
        </td>
        <td class="bg-sky-200 text-3xl" player="4" contenteditable="true">
          0
        </td>
        <td class="bg-violet-200 text-3xl" player="5" contenteditable="true">
          0
        </td>
      </tr>
      <tr class="border-t-3">
        <th class="bg-slate-400" rowspan="3">
          <div
            class="[writing-mode:sideways-lr] bg-slate-400 h-[100%] w-[100%] flex justify-center items-center"
          >
            One Point Each
          </div>
        </th>
        <th class="bg-slate-200">Eggs</th>
        <td class="bg-red-200 text-3xl" player="1" contenteditable="true">0</td>
        <td class="bg-amber-200 text-3xl" player="2" contenteditable="true">
          0
        </td>
        <td class="bg-green-200 text-3xl" player="3" contenteditable="true">
          0
        </td>
        <td class="bg-sky-200 text-3xl" player="4" contenteditable="true">
          0
        </td>
        <td class="bg-violet-200 text-3xl" player="5" contenteditable="true">
          0
        </td>
      </tr>
      <tr>
        <th class="bg-slate-200">Cached Food</th>
        <td class="bg-red-200 text-3xl" player="1" contenteditable="true">0</td>
        <td class="bg-amber-200 text-3xl" player="2" contenteditable="true">
          0
        </td>
        <td class="bg-green-200 text-3xl" player="3" contenteditable="true">
          0
        </td>
        <td class="bg-sky-200 text-3xl" player="4" contenteditable="true">
          0
        </td>
        <td class="bg-violet-200 text-3xl" player="5" contenteditable="true">
          0
        </td>
      </tr>
      <tr>
        <th class="bg-slate-200">Tucked Cards</th>
        <td class="bg-red-200 text-3xl" player="1" contenteditable="true">0</td>
        <td class="bg-amber-200 text-3xl" player="2" contenteditable="true">
          0
        </td>
        <td class="bg-green-200 text-3xl" player="3" contenteditable="true">
          0
        </td>
        <td class="bg-sky-200 text-3xl" player="4" contenteditable="true">
          0
        </td>
        <td class="bg-violet-200 text-3xl" player="5" contenteditable="true">
          0
        </td>
      </tr>
      <tr class="border-t-5">
        <th colspan="2" class="bg-slate-500">Total</th>
        <td class="bg-red-300 text-3xl" id="total-p1">0</td>
        <td class="bg-amber-300 text-3xl" id="total-p2">0</td>
        <td class="bg-green-300 text-3xl" id="total-p3">0</td>
        <td class="bg-sky-300 text-3xl" id="total-p4">0</td>
        <td class="bg-violet-300 text-3xl" id="total-p5">0</td>
      </tr>
    </table>

    <script>
      function reset() {
        document
          .querySelectorAll('td[contenteditable="true"]')
          .forEach((td) => {
            td.textContent = 0;
          });
        [1, 2, 3, 4, 5].forEach((i) => doTotal(i));
      }
      function handleScoreChange(td) {
        if (!Number.isInteger(Number(td.textContent.trim())))
          td.textContent = "";
      }
      function handleScoreBlur(td) {
        if (td.textContent.trim() == "") td.textContent = "0";
        doTotal(td.getAttribute("player"));
      }
      function handleScoreFocus(td) {
        if (td.textContent.trim() == "0") td.textContent = "";
      }
      function handleNameChange(th) {
        if (
          th.textContent.trim().length > 2 ||
          th.textContent.trim().length != th.textContent.length
        ) {
          th.textContent = th.textContent.trim().substring(0, 2);
          const range = document.createRange();
          range.selectNodeContents(th);
          range.collapse(false); // Collapse to end
          window.getSelection().removeAllRanges();
          window.getSelection().addRange(range);
        }
      }
      function handleNameBlur(th) {
        if (th.textContent.trim() == "")
          th.textContent = "P" + th.getAttribute("player");
      }
      function handleNameFocus(th) {
        if (th.textContent.trim() == "P" + th.getAttribute("player"))
          th.textContent = "";
      }

      function doTotal(player) {
        totalPt = 0;
        document.querySelectorAll(`td[player="${player}"]`).forEach((td) => {
          totalPt += Number(td.textContent.trim());
        });
        document.getElementById(`total-p${player}`).textContent = totalPt;
      }

      document.querySelectorAll('td[contenteditable="true"]').forEach((td) => {
        td.addEventListener("input", () => {
          handleScoreChange(td);
        });
        td.addEventListener("blur", () => {
          handleScoreBlur(td);
        });
        td.addEventListener("focus", () => {
          handleScoreFocus(td);
        });
      });

      document.querySelectorAll('th[contenteditable="true"]').forEach((th) => {
        th.addEventListener("input", () => {
          handleNameChange(th);
        });
        th.addEventListener("blur", () => {
          handleNameBlur(th);
        });
        th.addEventListener("focus", () => {
          handleNameFocus(th);
        });
      });
    </script>
  </body>
</html>
